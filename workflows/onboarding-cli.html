<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gremlin CLI - Onboarding</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&family=Inter:wght@400;600&display=swap');

        body {
            background-color: #050505;
            color: #c9d1d9;
            overflow: hidden;
            font-family: 'Fira Code', monospace;
        }

        /* Terminal Scrollbar */
        .terminal-scroll::-webkit-scrollbar {
            width: 8px;
        }

        .terminal-scroll::-webkit-scrollbar-track {
            background: #0d1117;
        }

        .terminal-scroll::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 4px;
        }

        .terminal-scroll::-webkit-scrollbar-thumb:hover {
            background: #484f58;
        }

        /* Cursor */
        .cursor {
            display: inline-block;
            width: 10px;
            height: 1.2em;
            background-color: #4ade80;
            animation: blink 1s step-end infinite;
            vertical-align: text-bottom;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        /* Tables */
        .term-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: 0.9rem;
        }

        .term-table th {
            text-align: left;
            border-bottom: 1px solid #30363d;
            color: #8b949e;
            padding: 0.5rem;
        }

        .term-table td {
            padding: 0.5rem;
            border-bottom: 1px solid #21262d;
        }

        /* Diff Colors */
        .diff-add { color: #4ade80; }
        .diff-remove { color: #fdaeb7; }
        .diff-header { color: #8b949e; }

        /* Scanline */
        .scanline {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0) 50%, rgba(0, 0, 0, 0.02) 50%, rgba(0, 0, 0, 0.02));
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 10;
        }

        /* ASCII Art - Single Color */
        .gremlin-green {
            color: #4ade80;
            text-shadow: 0 0 10px rgba(74, 222, 128, 0.3);
        }

        .ascii-art {
            font-weight: bold;
            line-height: 1.1;
        }

        /* Box styling */
        .info-box {
            border: 1px solid #30363d;
            border-radius: 6px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .info-box-header {
            background: #161b22;
            padding: 0.5rem 1rem;
            border-bottom: 1px solid #30363d;
            font-weight: bold;
        }

        .info-box-content {
            padding: 1rem;
        }

        .ecosystem-row {
            display: flex;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #21262d;
        }

        .ecosystem-row:last-child {
            border-bottom: none;
        }

        .ecosystem-num {
            color: #4ade80;
            font-weight: bold;
            width: 30px;
        }

        .ecosystem-name {
            color: #fff;
            font-weight: bold;
            width: 140px;
        }

        .ecosystem-desc {
            color: #8b949e;
            flex: 1;
        }
    </style>
</head>

<body class="h-screen w-screen flex flex-col p-4 md:p-8 selection:bg-green-500/30 justify-center items-center">

    <div class="scanline"></div>

    <!-- Terminal Window -->
    <div class="bg-[#0d1117] border border-[#30363d] rounded-lg shadow-2xl flex flex-col overflow-hidden relative w-full max-w-5xl h-[85vh]">

        <!-- Title Bar -->
        <div class="bg-[#010409] px-4 py-2 flex items-center justify-between border-b border-[#30363d]">
            <div class="flex space-x-2">
                <div class="w-3 h-3 rounded-full bg-[#ff5f56]"></div>
                <div class="w-3 h-3 rounded-full bg-[#ffbd2e]"></div>
                <div class="w-3 h-3 rounded-full bg-[#27c93f]"></div>
            </div>
            <div class="text-xs text-[#8b949e] font-semibold flex items-center">
                <i class="fa-solid fa-shield-halved mr-2 text-green-500"></i> new-hire@tempus-cluster-01
            </div>
            <div class="w-12"></div>
        </div>

        <!-- Content -->
        <div id="terminal-output" class="flex-grow p-6 overflow-y-auto terminal-scroll text-sm md:text-base font-mono">

            <!-- Welcome Banner -->
            <div class="mb-8 animate-fade-in flex items-start space-x-6 border-b border-[#30363d] pb-6">
                <!-- GIZMO ART -->
                <pre class="gremlin-green text-[10px] md:text-[12px] leading-none block">
         ,           ,
        / \         / \
       /   \       /   \
      /     \     /     \
     (       \___/       )
      \   O         O   /
       \       ^       /
        \    _____    /
         \__/     \__/
                </pre>

                <!-- TEXT LOGO -->
                <div>
                    <pre class="ascii-art gremlin-green text-[10px] md:text-xs leading-[1.1]">
  ____ ____  _____ __  __ _     ___ _   _
 / ___|  _ \| ____|  \/  | |   |_ _| \ | |
| |  _| |_) |  _| | |\/| | |    | ||  \| |
| |_| |  _ <| |___| |  | | |___ | || |\  |
 \____|_| \_\_____|_|  |_|_____|___|_| \_|</pre>
                    <div class="text-[#8b949e] mt-3 mb-1">Tempus Gremlin CLI <span class="text-green-400">v2.4</span></div>
                    <div class="text-[#c9d1d9] text-[11px] uppercase tracking-wide font-semibold">
                        <span class="gremlin-green">G</span>ENERATIVE
                        <span class="gremlin-green">R</span>ESEARCH
                        <span class="gremlin-green">E</span>NGINE FOR
                        <span class="gremlin-green">M</span>ACHINE
                        <span class="gremlin-green">L</span>EARNING
                        <span class="gremlin-green">I</span>NFRASTRUCTURE &
                        <span class="gremlin-green">N</span>AVIGATION
                    </div>
                </div>
            </div>

            <!-- History -->
            <div id="history"></div>

            <!-- Input Line -->
            <div class="flex items-center mt-4 pb-2" id="input-line">
                <span class="text-green-400 font-bold mr-2">gremlin ></span>
                <div class="relative flex-grow">
                    <input type="text" id="terminal-input"
                        class="w-full bg-transparent border-none outline-none text-[#e6edf3] font-mono caret-transparent"
                        autocomplete="off" spellcheck="false" autofocus>
                    <div id="ghost-text"
                        class="absolute top-0 left-0 pointer-events-none text-[#e6edf3] opacity-50 whitespace-pre-wrap">
                    </div>
                </div>
                <span class="cursor"></span>
            </div>
        </div>
    </div>

    <!-- PRO TIP BADGE -->
    <div class="fixed bottom-8 left-1/2 -translate-x-1/2 z-50 pointer-events-none opacity-70">
        <div class="bg-[#0d1117]/90 text-[#8b949e] text-xs px-4 py-2 rounded-full border border-[#30363d] shadow-2xl backdrop-blur-md flex items-center gap-2">
            <i class="fa-solid fa-terminal text-green-500"></i>
            <span>Pro Tip: Press <span class="text-green-400 font-bold font-mono bg-[#30363d] px-1.5 rounded mx-1">TAB</span> to auto-complete commands</span>
        </div>
    </div>

    <script>
        // --- ONBOARDING SCENARIO SCRIPT ---
        const endToEndScenario = [
            // Phase 1: Orientation
            {
                user: "I just joined the ML team. Give me an overview of the ML infrastructure.",
                ai: {
                    think: "Querying knowledge base... Loading ecosystem map for new ML scientists...",
                    response: `
                        <div class="text-[#c9d1d9] mb-4">Welcome to Tempus ML! Let me orient you.</div>

                        <div class="text-green-400 font-bold mb-3">THE TEMPUS ML ECOSYSTEM</div>
                        <div class="text-[#c9d1d9] mb-3">You'll work with three main systems:</div>

                        <div class="info-box">
                            <div class="info-box-content">
                                <div class="ecosystem-row">
                                    <span class="ecosystem-num">1.</span>
                                    <span class="ecosystem-name">ATLAS</span>
                                    <span class="ecosystem-desc">"Where experiments live" ‚Äî Tracks datasets, models, and runs. Everything has a URI: <code class="text-purple-400">atlas://datasets/my_cohort</code></span>
                                </div>
                                <div class="ecosystem-row">
                                    <span class="ecosystem-num">2.</span>
                                    <span class="ecosystem-name">HYPERNEXUS</span>
                                    <span class="ecosystem-desc">"Where training happens" ‚Äî H200 GPU cluster (up to 512 GPUs). Submit jobs via Ray.</span>
                                </div>
                                <div class="ecosystem-row">
                                    <span class="ecosystem-num">3.</span>
                                    <span class="ecosystem-name">INFERNO</span>
                                    <span class="ecosystem-desc">"Where models go to production" ‚Äî vLLM-based inference platform.</span>
                                </div>
                            </div>
                        </div>

                        <div class="text-[#8b949e] text-sm mt-4 border-l-2 border-green-500 pl-3">
                            <strong class="text-green-400">Your daily workflow:</strong> Atlas (data) ‚Üí Hypernexus (train) ‚Üí Atlas (log) ‚Üí Inferno (deploy)
                        </div>

                        <div class="text-[#c9d1d9] mt-4">Want me to walk you through your first experiment? <span class="text-green-400">[Y/n]</span></div>
                    `
                }
            },
            // Phase 2: First Experiment Setup
            {
                user: "Y",
                ai: {
                    think: "Generating guided tutorial... Checking environment prerequisites...",
                    response: `
                        <div class="text-green-400 font-bold mb-3">TUTORIAL: Your First Experiment</div>

                        <div class="text-[#c9d1d9] mb-3"><strong>STEP 1:</strong> Check your environment</div>
                        <div class="bg-[#161b22] p-3 rounded border border-[#30363d] font-mono text-xs mb-4">
                            $ atlas-sdk --version  <span class="text-[#8b949e]"># Should be >= 2.4.0</span><br>
                            $ hypernexus-cli ping  <span class="text-[#8b949e]"># Should return "OK"</span>
                        </div>

                        <div class="text-[#c9d1d9] mb-3"><strong>STEP 2:</strong> Find a dataset</div>
                        <div class="text-[#8b949e] text-sm mb-2">Let's use a pre-curated cohort for learning:</div>

                        <table class="term-table" style="width: 100%">
                            <thead><tr><th>Name</th><th>Task</th><th>Size</th><th>Description</th></tr></thead>
                            <tbody>
                                <tr><td class="text-green-400">tutorial_nsclc_v1</td><td>Classification</td><td>500 pts</td><td>NSCLC subtype prediction</td></tr>
                                <tr><td class="text-purple-400">tutorial_mm_survival</td><td>Survival</td><td>300 pts</td><td>Multiple Myeloma OS</td></tr>
                            </tbody>
                        </table>

                        <div class="text-[#c9d1d9] mt-4">Which one? <span class="text-green-400">[1/2]</span></div>
                    `
                }
            },
            // Phase 2 continued: Generate config
            {
                user: "1",
                ai: {
                    think: "Creating experiment config for tutorial_nsclc_v1... Applying best-practice defaults...",
                    response: `
                        <div class="text-green-400 mb-2">Generated: <span class="text-purple-400">tutorial_experiment.yaml</span></div>

                        <div class="bg-[#161b22] p-3 rounded border border-[#30363d] font-mono text-xs mb-4">
                            <div class="diff-header">experiment:</div>
                            <div class="diff-add">&nbsp;&nbsp;name: my-first-experiment</div>
                            <div class="diff-add">&nbsp;&nbsp;task: classification</div>
                            <div class="diff-header">data:</div>
                            <div class="diff-add">&nbsp;&nbsp;dataset: atlas://datasets/tutorial_nsclc_v1</div>
                            <div class="diff-add">&nbsp;&nbsp;split_seed: 42</div>
                            <div class="diff-header">model:</div>
                            <div class="diff-add">&nbsp;&nbsp;architecture: logistic_regression <span class="text-[#8b949e]"># Simple baseline</span></div>
                            <div class="diff-add">&nbsp;&nbsp;features: ["age", "stage", "histology"]</div>
                            <div class="diff-header">compute:</div>
                            <div class="diff-add">&nbsp;&nbsp;gpus: 1 <span class="text-[#8b949e]"># Single GPU for tutorial</span></div>
                            <div class="diff-add">&nbsp;&nbsp;node_type: n1-standard-8</div>
                        </div>

                        <div class="text-[#c9d1d9]">Ready to run? This will use ~$2 of compute. <span class="text-green-400">[Y/n]</span></div>
                    `
                }
            },
            // Phase 2 continued: Submit and complete job
            {
                user: "Y",
                ai: {
                    think: "Submitting to Hypernexus... Initializing distributed group...",
                    response: `
                        <div class="text-[#c9d1d9]">üöÄ Job <span class="text-purple-400">my-first-experiment</span> submitted to Hypernexus.</div>
                        <div class="text-[#8b949e] mt-2 text-xs font-mono">
                            [INFO] Initializing distributed group...<br>
                            [INFO] Loading data from Atlas...<br>
                            [INFO] Training started. Epoch 0/10...<br>
                            <span class="text-green-400">[SUCCESS] Job completed in 5m 12s.</span>
                        </div>

                        <div class="mt-4 text-green-400">‚úÖ Job completed successfully!</div>

                        <table class="term-table" style="width: 50%">
                            <thead><tr><th>Metric</th><th>Value</th></tr></thead>
                            <tbody>
                                <tr><td>Accuracy</td><td class="text-white font-bold">0.78</td></tr>
                                <tr><td>F1-Score</td><td class="text-white font-bold">0.72</td></tr>
                                <tr><td>AUC</td><td class="text-white font-bold">0.81</td></tr>
                            </tbody>
                        </table>

                        <div class="mt-4 text-[#c9d1d9]">
                            Congratulations on your first experiment! üéâ<br><br>
                            <span class="text-[#8b949e]">Next steps:</span><br>
                            1. View the full report: <code class="text-purple-400">gremlin > show results my-first-experiment</code><br>
                            2. Try a harder task: <code class="text-purple-400">gremlin > walk me through a survival model</code><br>
                            3. Learn about fusion models: <code class="text-purple-400">gremlin > explain late fusion</code>
                        </div>
                    `
                }
            },
            // Phase 3: Deep Dive - How do I add RNA?
            {
                user: "How do I add RNA data to a fusion model?",
                ai: {
                    think: "Searching knowledge base (74 repos, 12 wiki spaces)... Found 8 relevant sources. Synthesizing answer...",
                    response: `
                        <div class="text-green-400 font-bold mb-3">ADDING RNA DATA TO FUSION MODELS</div>

                        <div class="text-[#c9d1d9] mb-3"><strong>Short answer:</strong> Use the <code class="text-purple-400">unimodal-rna-model</code> embeddings as a frozen encoder.</div>

                        <div class="text-[#c9d1d9] mb-2"><strong>Step-by-step:</strong></div>

                        <div class="mb-4">
                            <div class="text-[#c9d1d9] mb-2">1. <strong>Get the RNA embeddings</strong></div>
                            <div class="text-[#8b949e] text-sm mb-2">The best current RNA encoder is <code class="text-green-400">rna_encoder_v3</code> (C-Index 0.72).</div>
                            <div class="bg-[#161b22] p-3 rounded border border-[#30363d] font-mono text-xs">
                                encoders:<br>
                                &nbsp;&nbsp;rna:<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;checkpoint: atlas://artifacts/rna_encoder_v3<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;trainable: false  <span class="text-[#8b949e]"># Keep frozen</span>
                            </div>
                        </div>

                        <div class="mb-4">
                            <div class="text-[#c9d1d9] mb-2">2. <strong>Ensure your cohort has RNA coverage</strong></div>
                            <div class="text-[#8b949e] text-sm">Not all patients have RNA sequencing. Check coverage first:</div>
                            <div class="bg-[#161b22] p-2 rounded border border-[#30363d] font-mono text-xs mt-2">
                                gremlin > check RNA coverage for my_cohort
                            </div>
                        </div>

                        <div class="mb-4">
                            <div class="text-[#c9d1d9] mb-2">3. <strong>Join the data</strong></div>
                            <div class="text-[#8b949e] text-sm">The RNA features live in <code class="text-purple-400">rna-pan-transcriptomic-etl</code>.<br>
                            They're keyed by <code class="text-green-400">biospecimen_id</code>, which maps to <code class="text-green-400">patient_id</code> via TDM.</div>
                        </div>

                        <div class="text-[#8b949e] text-xs border-l-2 border-[#30363d] pl-3 mt-4">
                            <strong>Sources:</strong><br>
                            - ofm-late-fusion/README.md (lines 45-78)<br>
                            - unimodal-rna-model/docs/integration.md<br>
                            - Confluence: "Multimodal Fusion Best Practices"
                        </div>

                        <div class="text-[#c9d1d9] mt-4">Want me to generate a config with RNA for your current experiment? <span class="text-green-400">[Y/n]</span></div>
                    `
                }
            },
            // Phase 4: Troubleshooting - NCCL error
            {
                user: "My job failed with 'NCCL timeout exceeded.' What does this mean?",
                ai: {
                    think: "Analyzing error pattern... Matching against known failure modes...",
                    response: `
                        <div class="text-yellow-400 font-bold mb-3">üîç ERROR ANALYSIS: NCCL Timeout</div>

                        <div class="text-[#c9d1d9] mb-3">This is a <strong>common issue</strong> on Hypernexus due to TCP/IP networking (no RDMA).</div>

                        <div class="border-l-2 border-yellow-500 pl-3 mb-4">
                            <div class="text-yellow-400 font-bold text-sm mb-1">Root Cause:</div>
                            <div class="text-[#c9d1d9] text-sm">NCCL (GPU communication library) timed out waiting for a response from another GPU. This usually happens during large gradient synchronization in distributed training.</div>
                        </div>

                        <div class="text-[#c9d1d9] mb-2"><strong>Likely causes</strong> (in order of probability):</div>
                        <table class="term-table" style="width: 100%">
                            <tbody>
                                <tr><td>1. <strong>Batch size too large</strong></td><td class="text-[#8b949e]">Gradient sync takes longer than timeout</td></tr>
                                <tr><td>2. <strong>Straggler node</strong></td><td class="text-[#8b949e]">One GPU is slower, others wait</td></tr>
                                <tr><td>3. <strong>Network congestion</strong></td><td class="text-[#8b949e]">Too many jobs competing for bandwidth</td></tr>
                            </tbody>
                        </table>

                        <div class="text-[#c9d1d9] mt-4 mb-2"><strong>Solutions:</strong></div>

                        <div class="bg-[#161b22] p-3 rounded border border-[#30363d] font-mono text-xs mb-3">
                            <div class="text-yellow-400 mb-1"># Option 1: Increase timeout (quick fix)</div>
                            env:<br>
                            &nbsp;&nbsp;NCCL_TIMEOUT: 3600  <span class="text-[#8b949e]"># 1 hour instead of default 30 min</span>
                        </div>

                        <div class="bg-[#161b22] p-3 rounded border border-[#30363d] font-mono text-xs mb-3">
                            <div class="text-green-400 mb-1"># Option 2: Reduce sync frequency (better fix)</div>
                            training:<br>
                            &nbsp;&nbsp;gradient_accumulation_steps: 4  <span class="text-[#8b949e]"># Sync every 4 steps</span>
                        </div>

                        <div class="bg-[#161b22] p-3 rounded border border-[#30363d] font-mono text-xs">
                            <div class="text-purple-400 mb-1"># Option 3: Use FSDP more aggressively (best fix)</div>
                            distributed:<br>
                            &nbsp;&nbsp;strategy: fsdp<br>
                            &nbsp;&nbsp;sharding_strategy: FULL_SHARD
                        </div>

                        <div class="text-[#8b949e] text-xs mt-4 border-l-2 border-[#30363d] pl-3">
                            <strong>Documented in:</strong> sre/runbooks/nccl-troubleshooting.md, hypernexus-template/docs/distributed-training.md
                        </div>

                        <div class="text-[#c9d1d9] mt-4">Want me to apply one of these fixes to your config? <span class="text-green-400">[1/2/3]</span></div>
                    `
                }
            },
            // Phase 4 continued: Apply fix
            {
                user: "2",
                ai: {
                    think: "Applying gradient accumulation fix to config...",
                    response: `
                        <div class="text-green-400 mb-2">‚úî Config updated with gradient accumulation.</div>

                        <div class="bg-[#161b22] p-3 rounded border border-[#30363d] font-mono text-xs mb-4">
                            <div class="diff-header">training:</div>
                            <div class="diff-add">+  gradient_accumulation_steps: 4</div>
                            <div class="diff-header">  batch_size: 32 <span class="text-[#8b949e]"># Effective batch = 128</span></div>
                        </div>

                        <div class="text-[#c9d1d9]">This reduces network traffic by 4x while maintaining the same effective batch size.</div>
                        <div class="text-[#c9d1d9] mt-2">Ready to resubmit the job? <span class="text-green-400">[Y/n]</span></div>
                    `
                }
            },
            // Phase 5: Best Practices Review
            {
                user: "Review my experiment config for best practices.",
                ai: {
                    think: "Analyzing config: exp_nsclc_v2.yaml... Checking against Tempus ML best practices...",
                    response: `
                        <div class="text-green-400 font-bold mb-3">CONFIG REVIEW</div>

                        <div class="mb-4">
                            <div class="text-green-400 mb-2">‚úÖ GOOD PRACTICES:</div>
                            <ul class="text-[#c9d1d9] text-sm ml-4 list-disc">
                                <li>Using pinned dataset with SHA (reproducibility)</li>
                                <li>Checkpoint frequency is appropriate (every 500 steps)</li>
                                <li>Using mixed precision (BF16)</li>
                            </ul>
                        </div>

                        <div class="mb-4">
                            <div class="text-yellow-400 mb-2">‚ö†Ô∏è SUGGESTIONS:</div>
                            <table class="term-table" style="width: 100%">
                                <tbody>
                                    <tr><td class="text-yellow-400">1.</td><td><strong>Missing seed</strong></td><td class="text-[#8b949e]">Add <code>seed: 42</code> for reproducibility</td></tr>
                                    <tr><td class="text-yellow-400">2.</td><td><strong>Batch size</strong></td><td class="text-[#8b949e]">128 may OOM on H200. Recommend 64 with gradient_accumulation: 2</td></tr>
                                    <tr><td class="text-yellow-400">3.</td><td><strong>No validation frequency</strong></td><td class="text-[#8b949e]">Add <code>val_every_n_steps: 100</code></td></tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="mb-4">
                            <div class="text-red-400 mb-2">‚ùå ISSUES:</div>
                            <div class="bg-[#161b22] p-3 rounded border border-[#30363d] font-mono text-xs mb-3">
                                <div class="text-red-400 mb-1"># 1. Hardcoded GCS path (breaks lineage tracking)</div>
                                <div class="diff-remove">- gs://tempus-ml-data/checkpoints/</div>
                                <div class="diff-add">+ atlas://runs/\${RUN_ID}/checkpoints/</div>
                            </div>

                            <div class="bg-[#161b22] p-3 rounded border border-[#30363d] font-mono text-xs">
                                <div class="text-red-400 mb-1"># 2. Missing experiment tags</div>
                                <div class="diff-add">+ tags:</div>
                                <div class="diff-add">+   modality: fusion</div>
                                <div class="diff-add">+   indication: NSCLC</div>
                                <div class="diff-add">+   owner: jsmith@tempus.com</div>
                            </div>
                        </div>

                        <div class="text-[#c9d1d9] mt-4">Apply these fixes automatically? <span class="text-green-400">[Y/n]</span></div>
                    `
                }
            },
            // Phase 5 continued: Apply fixes
            {
                user: "Y",
                ai: {
                    think: "Applying 5 fixes to config... Validating updated configuration...",
                    response: `
                        <div class="text-green-400 mb-2">‚úî Updated config saved to: <span class="text-purple-400">exp_nsclc_v2_reviewed.yaml</span></div>
                        <div class="text-[#8b949e] text-sm mb-4">Diff: +12 lines, -3 lines</div>

                        <div class="border-l-2 border-green-500 pl-3 mb-4">
                            <div class="text-green-400 font-bold text-sm">Summary of changes:</div>
                            <ul class="text-[#c9d1d9] text-sm mt-2 list-disc ml-4">
                                <li>Added <code>seed: 42</code></li>
                                <li>Reduced batch_size to 64, added gradient_accumulation: 2</li>
                                <li>Added <code>val_every_n_steps: 100</code></li>
                                <li>Replaced GCS path with Atlas URI</li>
                                <li>Added experiment tags</li>
                            </ul>
                        </div>

                        <div class="text-green-400 font-bold mb-3">üéì ONBOARDING COMPLETE!</div>
                        <div class="text-[#c9d1d9]">
                            You've learned the essentials:<br><br>
                            ‚úÖ <strong>Ecosystem overview</strong> ‚Äî Atlas, Hypernexus, Inferno<br>
                            ‚úÖ <strong>First experiment</strong> ‚Äî Config generation, job submission, results<br>
                            ‚úÖ <strong>Knowledge lookup</strong> ‚Äî Finding information across 74 repos<br>
                            ‚úÖ <strong>Troubleshooting</strong> ‚Äî Diagnosing and fixing common errors<br>
                            ‚úÖ <strong>Best practices</strong> ‚Äî Config review and automated fixes<br><br>

                            <span class="text-[#8b949e]">Time to productivity with GREMLIN:</span> <span class="text-green-400 font-bold">~2 hours</span><br>
                            <span class="text-[#8b949e]">Traditional onboarding:</span> <span class="text-red-400">3-4 weeks</span>
                        </div>
                    `
                }
            }
        ];

        // --- ENGINE ---
        const state = { step: 0, isTyping: false, isThinking: false, typedText: "" };
        const elements = {
            history: document.getElementById('history'),
            input: document.getElementById('terminal-input'),
            ghost: document.getElementById('ghost-text'),
            output: document.getElementById('terminal-output')
        };

        function startScenario() {
            state.step = 0;
            elements.history.innerHTML = '';
            const div = document.createElement('div');
            div.className = "my-4 border-t border-dashed border-slate-700 pt-2 text-center text-xs text-slate-600";
            div.innerText = `--- NEW SESSION: ONBOARDING JOURNEY ---`;
            elements.history.appendChild(div);
            prepareStep();
        }

        function prepareStep() {
            if (state.step >= endToEndScenario.length) {
                state.targetText = "";
                elements.input.value = "";
                elements.ghost.textContent = "";

                const endDiv = document.createElement('div');
                endDiv.className = "mt-8 text-center text-[#8b949e] text-xs animate-pulse";
                endDiv.innerText = "[ END OF ONBOARDING DEMO ]";
                elements.history.appendChild(endDiv);
                scrollToBottom();
                window.parent.postMessage({ type: 'workflowComplete' }, '*');
                return;
            }
            state.targetText = endToEndScenario[state.step].user;
            state.typedText = "";
            elements.input.value = "";
            elements.ghost.textContent = "";
            elements.input.focus();
            scrollToBottom();
        }

        function scrollToBottom() {
            elements.output.scrollTop = elements.output.scrollHeight;
            requestAnimationFrame(() => {
                elements.output.scrollTop = elements.output.scrollHeight;
            });
        }

        function addEntry(type, content) {
            const div = document.createElement('div');
            div.className = "mb-6 animate-fade-in";

            if (type === 'user') {
                div.innerHTML = `
                    <div class="flex items-start">
                        <span class="text-green-400 font-bold mr-2 mt-0.5">‚ùØ</span>
                        <div class="text-[#e6edf3] font-semibold">${content}</div>
                    </div>
                `;
            } else if (type === 'ai') {
                div.innerHTML = `
                    <div class="flex items-start mt-2">
                        <div class="text-purple-400 font-bold mr-3 mt-0.5 text-xs">GREMLIN</div>
                        <div class="flex-grow text-[#c9d1d9] leading-relaxed text-sm">${content}</div>
                    </div>
                `;
            } else if (type === 'think') {
                div.id = "thinking";
                div.innerHTML = `
                    <div class="flex items-center text-slate-500 text-xs ml-9 animate-pulse font-mono">
                        <i class="fa-solid fa-microchip mr-2"></i> ${content}
                    </div>
                `;
            }
            elements.history.appendChild(div);
            scrollToBottom();
            return div;
        }

        function submit() {
            if (state.step >= endToEndScenario.length) return;

            const text = elements.input.value;
            if (!text.trim()) return;

            addEntry('user', text);
            elements.input.value = "";
            elements.ghost.textContent = "";
            state.typedText = "";

            state.isThinking = true;
            const scenario = endToEndScenario[state.step];
            const thinkEl = addEntry('think', scenario.ai.think);

            setTimeout(() => {
                thinkEl.innerHTML = `
                    <div class="flex items-center text-slate-600 text-xs ml-9 font-mono">
                        <span class="text-green-500 mr-2">[LOG]</span> ${scenario.ai.think.replace('...', '')} ... <span class="text-green-500 ml-1">DONE</span>
                    </div>
                `;
                thinkEl.id = "";
                thinkEl.classList.remove("animate-pulse");

                addEntry('ai', scenario.ai.response);

                state.isThinking = false;
                state.step++;

                window.parent.postMessage({ type: 'cliStepComplete', step: state.step }, '*');

                prepareStep();
            }, 1200);
        }

        elements.input.addEventListener('keydown', (e) => {
            if (state.isThinking || state.step >= endToEndScenario.length) {
                e.preventDefault();
                return;
            }

            if (e.key === 'Tab') {
                e.preventDefault();
                if (state.typedText.length < state.targetText.length) {
                    state.typedText = state.targetText;
                    elements.input.value = state.typedText;
                    elements.ghost.textContent = state.typedText;
                    scrollToBottom();
                }
                return;
            }

            if (e.key === 'Enter') {
                state.typedText = state.targetText;
                elements.input.value = state.typedText;
                elements.ghost.textContent = state.typedText;
                submit();
                e.preventDefault();
            } else if (e.key === 'Backspace') {
                state.typedText = state.typedText.slice(0, -1);
                e.preventDefault();
            } else if (!e.ctrlKey && !e.metaKey && !e.altKey && e.key.length === 1) {
                e.preventDefault();
                const nextChar = state.targetText[state.typedText.length];
                if (nextChar) state.typedText += nextChar;
            }

            elements.input.value = state.typedText;
            elements.ghost.textContent = state.typedText;
            scrollToBottom();
        });

        document.getElementById('terminal-output').addEventListener('click', () => elements.input.focus());

        window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'resetWorkflow') {
                startScenario();
            }
        });

        startScenario();
    </script>
</body>

</html>

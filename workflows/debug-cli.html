<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gremlin CLI - Debug & Rescue</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&family=Inter:wght@400;600&display=swap');

        body {
            background-color: #050505;
            color: #c9d1d9;
            overflow: hidden;
            font-family: 'Fira Code', monospace;
        }

        .terminal-scroll::-webkit-scrollbar {
            width: 8px;
        }

        .terminal-scroll::-webkit-scrollbar-track {
            background: #0d1117;
        }

        .terminal-scroll::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 4px;
        }

        .cursor {
            display: inline-block;
            width: 10px;
            height: 1.2em;
            background-color: #4ade80;
            animation: blink 1s step-end infinite;
            vertical-align: text-bottom;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }
        }

        .term-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: 0.9rem;
        }

        .term-table th {
            text-align: left;
            border-bottom: 1px solid #30363d;
            color: #8b949e;
            padding: 0.5rem;
        }

        .term-table td {
            padding: 0.5rem;
            border-bottom: 1px solid #21262d;
        }

        .diff-add {
            color: #4ade80;
        }

        .diff-remove {
            color: #fdaeb7;
        }

        .scanline {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0) 50%, rgba(0, 0, 0, 0.02) 50%, rgba(0, 0, 0, 0.02));
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 10;
        }

        .gremlin-green {
            color: #4ade80;
            text-shadow: 0 0 10px rgba(74, 222, 128, 0.3);
        }

        .ascii-art {
            font-weight: bold;
            line-height: 1.1;
        }

        .code-block {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 1rem;
            font-family: monospace;
            font-size: 0.85rem;
            margin: 0.5rem 0;
            overflow-x: auto;
        }
    </style>
</head>

<body class="h-screen w-screen flex flex-col p-4 md:p-8 selection:bg-green-500/30 justify-center items-center">

    <div class="scanline"></div>

    <div
        class="bg-[#0d1117] border border-[#30363d] rounded-lg shadow-2xl flex flex-col overflow-hidden relative w-full max-w-5xl h-[85vh]">

        <div class="bg-[#010409] px-4 py-2 flex items-center justify-between border-b border-[#30363d]">
            <div class="flex space-x-2">
                <div class="w-3 h-3 rounded-full bg-[#ff5f56]"></div>
                <div class="w-3 h-3 rounded-full bg-[#ffbd2e]"></div>
                <div class="w-3 h-3 rounded-full bg-[#27c93f]"></div>
            </div>
            <div class="text-xs text-[#8b949e] font-semibold flex items-center">
                <i class="fa-solid fa-shield-halved mr-2 text-green-500"></i> scientist@tempus-cluster-01
            </div>
            <div class="w-12"></div>
        </div>

        <div id="terminal-output" class="flex-grow p-6 overflow-y-auto terminal-scroll text-sm md:text-base font-mono">

            <div class="mb-8 animate-fade-in flex items-start space-x-6 border-b border-[#30363d] pb-6">
                <pre class="gremlin-green text-[10px] md:text-[12px] leading-none block">
         ,           ,
        / \         / \
       /   \       /   \
      /     \     /     \
     (       \___/       )
      \   O         O   /
       \       ^       /
        \    _____    /
         \__/     \__/
                </pre>
                <div>
                    <pre class="ascii-art gremlin-green text-[10px] md:text-xs leading-[1.1]">
  ____ ____  _____ __  __ _     ___ _   _
 / ___|  _ \| ____|  \/  | |   |_ _| \ | |
| |  _| |_) |  _| | |\/| | |    | ||  \| |
| |_| |  _ <| |___| |  | | |___ | || |\  |
 \____|_| \_\_____|_|  |_|_____|___|_| \_|</pre>
                    <div class="text-[#8b949e] mt-3 mb-1">Tempus Gremlin CLI <span class="text-green-400">v2.4</span>
                    </div>
                    <div class="text-[#c9d1d9] text-[11px] uppercase tracking-wide font-semibold">
                        <span class="gremlin-green">G</span>ENERATIVE <span class="gremlin-green">R</span>ESEARCH <span
                            class="gremlin-green">E</span>NGINE FOR <span class="gremlin-green">M</span>ACHINE <span
                            class="gremlin-green">L</span>EARNING <span class="gremlin-green">I</span>NFRASTRUCTURE &
                        <span class="gremlin-green">N</span>AVIGATION
                    </div>
                </div>
            </div>

            <div id="history"></div>

            <div class="flex items-start mt-4 pb-2" id="input-line">
                <span class="text-green-400 font-bold mr-2">gremlin ></span>
                <div class="relative flex-grow">
                    <span id="typed-display" class="text-[#e6edf3] whitespace-pre-wrap break-words font-mono"></span>
                    <span class="cursor"></span>
                    <input type="text" id="terminal-input" class="absolute inset-0 w-full opacity-0 cursor-none"
                        autocomplete="off" spellcheck="false" autofocus>
                </div>
            </div>
        </div>
    </div>

    <div class="fixed bottom-8 left-1/2 -translate-x-1/2 z-50 pointer-events-none opacity-70">
        <div
            class="bg-[#0d1117]/90 text-[#8b949e] text-xs px-4 py-2 rounded-full border border-[#30363d] shadow-2xl backdrop-blur-md flex items-center gap-2">
            <i class="fa-solid fa-terminal text-green-500"></i>
            <span>Pro Tip: Press <span
                    class="text-green-400 font-bold font-mono bg-[#30363d] px-1.5 rounded mx-1">TAB</span> to
                auto-complete commands</span>
        </div>
    </div>

    <script>
        const endToEndScenario = [
            {
                user: "Why did job 'job-fusion-xl-v2' fail?",
                ai: {
                    think: "Pulling logs from GCS archive... Analyzing stack traces & node heartbeats...",
                    response: `
                        <div class="text-red-400 font-bold mb-3">üí• FAILURE ANALYSIS</div>

                        <table class="term-table" style="width: 80%">
                            <tbody>
                                <tr><td><strong>Root Cause</strong></td><td class="text-red-400 font-bold">CUDA Out of Memory (OOM)</td></tr>
                                <tr><td><strong>Location</strong></td><td>Node <code class="text-purple-400">gke-pool-1-node-43</code> (Rank 7)</td></tr>
                                <tr><td><strong>Step</strong></td><td>4,502 (Validation Loop)</td></tr>
                            </tbody>
                        </table>

                        <div class="border-l-2 border-yellow-500 pl-3 mt-4 text-sm">
                            <div class="text-yellow-400 font-bold mb-1">Context:</div>
                            <div class="text-[#c9d1d9]">
                                During validation, you compute metrics on the full batch.<br>
                                The <code class="text-yellow-400">contrastive_loss</code> calculation spiked VRAM usage to <span class="text-red-400">82GB</span> (Limit: 80GB).
                            </div>
                        </div>

                        <div class="mt-4">
                            <div class="text-[#c9d1d9] mb-2"><strong>Infrastructure Health:</strong></div>
                            <div class="text-green-400">‚úÖ All nodes are healthy. This is a <strong>software resource issue</strong>, not a hardware failure.</div>
                        </div>
                    `
                }
            },
            {
                user: "Fix the OOM and resume training.",
                ai: {
                    think: "Querying Atlas for checkpoints... Generating fix suggestion...",
                    response: `
                        <div class="text-green-400 font-bold mb-3">FIX & RESUME PLAN</div>

                        <div class="text-[#c9d1d9] mb-2"><strong>Suggested Fix:</strong></div>
                        <div class="code-block text-xs">
<span class="diff-remove">- val_batch_size: 32</span>
<span class="diff-add">+ val_batch_size: 16</span>
                        </div>

                        <div class="text-[#c9d1d9] mt-4 mb-2"><strong>Checkpoint Found:</strong></div>
                        <div class="text-[#8b949e] text-sm">
                            <code class="text-purple-400">atlas://runs/job-fusion-xl-v2/ckpt-step-4500</code><br>
                            <span class="text-green-400">Saved 2 minutes before crash.</span>
                        </div>

                        <div class="mt-4 border-l-2 border-green-500 pl-3">
                            <div class="text-green-400 font-bold text-sm mb-1">Action Plan:</div>
                            <ol class="text-[#c9d1d9] text-sm list-decimal ml-4">
                                <li>Clone config to <code>job-fusion-xl-v2-resume.yaml</code></li>
                                <li>Set <code>val_batch_size: 16</code></li>
                                <li>Set <code>resume_from: ckpt-step-4500</code></li>
                                <li>Submit to Hypernexus</li>
                            </ol>
                        </div>

                        <div class="text-[#c9d1d9] mt-4">Execute? <span class="text-green-400">[Y/n]</span></div>
                    `
                }
            },
            {
                user: "Y",
                ai: {
                    think: "Cloning config... Applying fix... Submitting Ray Job...",
                    response: `
                        <div class="text-green-400 mb-2">‚úî Config updated and submitted.</div>

                        <div class="text-[#8b949e] text-sm mb-4">
                            [INFO] Created: job-fusion-xl-v2-resume.yaml<br>
                            [INFO] Applied fix: val_batch_size: 32 ‚Üí 16<br>
                            [INFO] Resume checkpoint: ckpt-step-4500<br>
                            <span class="text-green-400">[SUCCESS] Job submitted to Hypernexus</span>
                        </div>

                        <div class="text-[#c9d1d9]">
                            üöÄ Resumed training. Job ID: <code class="text-purple-400">job-fusion-xl-v2-resume</code><br>
                            <span class="text-[#8b949e]">Starting from step 4,500 (saved $5k in wasted compute)</span>
                        </div>
                    `
                }
            },
            {
                user: "Monitor this run and alert me if anything looks wrong.",
                ai: {
                    think: "Enabling proactive monitoring for job-fusion-xl-v2-resume...",
                    response: `
                        <div class="text-green-400 font-bold mb-3">MONITORING CONFIGURATION</div>

                        <table class="term-table">
                            <thead><tr><th>Check</th><th>Threshold</th><th>Action</th></tr></thead>
                            <tbody>
                                <tr><td>Loss Spike</td><td>> 2x moving average</td><td><span class="text-yellow-400">Slack alert</span></td></tr>
                                <tr><td>GPU Memory</td><td>> 90% VRAM</td><td><span class="text-yellow-400">Warning log</span></td></tr>
                                <tr><td>Training Stall</td><td>No progress for 10 min</td><td><span class="text-red-400">Slack alert</span></td></tr>
                                <tr><td>MFU Drop</td><td>< 30% efficiency</td><td><span class="text-yellow-400">Investigation prompt</span></td></tr>
                            </tbody>
                        </table>

                        <div class="text-[#8b949e] text-sm mt-4">
                            Notification: Slack DM to @scientist<br>
                            Monitoring: <span class="text-green-400 font-bold">ACTIVE</span>
                        </div>
                    `
                }
            },
            {
                user: "How is the resumed job doing?",
                ai: {
                    think: "Fetching metrics from W&B... Checking resource utilization...",
                    response: `
                        <div class="text-green-400 font-bold mb-3">HEALTH CHECK: job-fusion-xl-v2-resume (Step 6,200)</div>

                        <table class="term-table" style="width: 80%">
                            <thead><tr><th>Metric</th><th>Current</th><th>Expected</th><th>Status</th></tr></thead>
                            <tbody>
                                <tr><td>Loss</td><td class="text-green-400">1.82</td><td>1.85</td><td><span class="text-green-400">‚úÖ Normal</span></td></tr>
                                <tr><td>MFU</td><td class="text-green-400">47%</td><td>45%</td><td><span class="text-green-400">‚úÖ Good</span></td></tr>
                                <tr><td>VRAM</td><td class="text-green-400">78%</td><td>75%</td><td><span class="text-green-400">‚úÖ OK</span></td></tr>
                                <tr><td>Tokens/sec</td><td>142k</td><td>145k</td><td><span class="text-green-400">‚úÖ Normal</span></td></tr>
                            </tbody>
                        </table>

                        <div class="mt-4 text-center">
                            <span class="text-green-400 font-bold text-2xl">üü¢ HEALTHY</span>
                        </div>

                        <div class="text-[#8b949e] text-sm mt-4">
                            Projected completion: <span class="text-green-400">Tomorrow at 2:15 PM</span><br>
                            No action required.
                        </div>
                    `
                }
            },
            {
                user: "What common errors should I watch out for on Hypernexus?",
                ai: {
                    think: "Querying knowledge base for Tempus-specific failure patterns...",
                    response: `
                        <div class="text-green-400 font-bold mb-3">COMMON FAILURE PATTERNS</div>

                        <table class="term-table">
                            <thead><tr><th>Error Pattern</th><th>Root Cause</th><th>GREMLIN Fix</th></tr></thead>
                            <tbody>
                                <tr>
                                    <td class="text-red-400">NCCL timeout exceeded</td>
                                    <td class="text-[#8b949e]">GPU sync timeout (TCP/IP latency)</td>
                                    <td class="text-green-400">Increase NCCL_TIMEOUT or reduce sync frequency</td>
                                </tr>
                                <tr>
                                    <td class="text-red-400">CUDA OOM</td>
                                    <td class="text-[#8b949e]">Batch too large for VRAM</td>
                                    <td class="text-green-400">Reduce batch size or enable gradient checkpointing</td>
                                </tr>
                                <tr>
                                    <td class="text-red-400">Ray actor died</td>
                                    <td class="text-[#8b949e]">Node preemption (Spot)</td>
                                    <td class="text-green-400">Auto-resume from checkpoint</td>
                                </tr>
                                <tr>
                                    <td class="text-red-400">Connection refused: Atlas</td>
                                    <td class="text-[#8b949e]">Network partition</td>
                                    <td class="text-green-400">Retry with backoff</td>
                                </tr>
                                <tr>
                                    <td class="text-red-400">FileNotFoundError: checkpoint</td>
                                    <td class="text-[#8b949e]">Stale GCS cache</td>
                                    <td class="text-green-400">Clear gcsfuse cache, re-mount</td>
                                </tr>
                                <tr>
                                    <td class="text-red-400">Diverged: loss=NaN</td>
                                    <td class="text-[#8b949e]">Learning rate too high</td>
                                    <td class="text-green-400">Reduce LR, check for data corruption</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="border-l-2 border-green-500 pl-3 mt-4 text-sm">
                            <span class="text-green-400">Tip:</span> If you encounter any of these errors, paste the error message and I'll diagnose it with Tempus-specific context.
                        </div>
                    `
                }
            }
        ];

        const state = { step: 0, isTyping: false, isThinking: false, typedText: "" };
        const elements = { history: document.getElementById('history'), input: document.getElementById('terminal-input'), display: document.getElementById('typed-display'), output: document.getElementById('terminal-output') };

        function startScenario() {
            state.step = 0; elements.history.innerHTML = '';
            const div = document.createElement('div');
            div.className = "my-4 border-t border-dashed border-slate-700 pt-2 text-center text-xs text-slate-600";
            div.innerText = `--- NEW SESSION: DEBUG & RESCUE ---`;
            elements.history.appendChild(div); prepareStep();
        }

        function prepareStep() {
            if (state.step >= endToEndScenario.length) {
                state.targetText = ""; elements.input.value = ""; elements.display.textContent = "";
                const endDiv = document.createElement('div');
                endDiv.className = "mt-8 text-center text-[#8b949e] text-xs animate-pulse";
                endDiv.innerText = "[ END OF DEBUG DEMO ]";
                elements.history.appendChild(endDiv); scrollToBottom();
                window.parent.postMessage({ type: 'workflowComplete' }, '*');
                return;
            }
            state.targetText = endToEndScenario[state.step].user;
            state.typedText = ""; elements.input.value = ""; elements.display.textContent = "";
            elements.input.focus(); scrollToBottom();
        }

        function scrollToBottom() { elements.output.scrollTop = elements.output.scrollHeight; requestAnimationFrame(() => { elements.output.scrollTop = elements.output.scrollHeight; }); }

        function addEntry(type, content) {
            const div = document.createElement('div'); div.className = "mb-6 animate-fade-in";
            if (type === 'user') { div.innerHTML = `<div class="flex items-start"><span class="text-green-400 font-bold mr-2 mt-0.5">‚ùØ</span><div class="text-[#e6edf3] font-semibold">${content}</div></div>`; }
            else if (type === 'ai') { div.innerHTML = `<div class="flex items-start mt-2"><div class="text-purple-400 font-bold mr-3 mt-0.5 text-xs">GREMLIN</div><div class="flex-grow text-[#c9d1d9] leading-relaxed text-sm">${content}</div></div>`; }
            else if (type === 'think') { div.id = "thinking"; div.innerHTML = `<div class="flex items-center text-slate-500 text-xs ml-9 animate-pulse font-mono"><i class="fa-solid fa-microchip mr-2"></i> ${content}</div>`; }
            elements.history.appendChild(div); scrollToBottom(); return div;
        }

        function submit() {
            if (state.step >= endToEndScenario.length) return;
            const text = elements.input.value; if (!text.trim()) return;
            addEntry('user', text); elements.input.value = ""; elements.display.textContent = ""; state.typedText = "";
            state.isThinking = true;
            const scenario = endToEndScenario[state.step];
            const thinkEl = addEntry('think', scenario.ai.think);
            setTimeout(() => {
                thinkEl.innerHTML = `<div class="flex items-center text-slate-600 text-xs ml-9 font-mono"><span class="text-green-500 mr-2">[LOG]</span> ${scenario.ai.think.replace('...', '')} ... <span class="text-green-500 ml-1">DONE</span></div>`;
                thinkEl.id = ""; thinkEl.classList.remove("animate-pulse");
                addEntry('ai', scenario.ai.response);
                state.isThinking = false; state.step++;
                window.parent.postMessage({ type: 'cliStepComplete', step: state.step }, '*');
                prepareStep();
            }, 1200);
        }

        elements.input.addEventListener('keydown', (e) => {
            if (state.isThinking || state.step >= endToEndScenario.length) { e.preventDefault(); return; }
            if (e.key === 'Tab') { e.preventDefault(); if (state.typedText.length < state.targetText.length) { state.typedText = state.targetText; elements.input.value = state.typedText; elements.display.textContent = state.typedText; scrollToBottom(); } return; }
            if (e.key === 'Enter') { state.typedText = state.targetText; elements.input.value = state.typedText; elements.display.textContent = state.typedText; submit(); e.preventDefault(); }
            else if (e.key === 'Backspace') { state.typedText = state.typedText.slice(0, -1); e.preventDefault(); }
            else if (!e.ctrlKey && !e.metaKey && !e.altKey && e.key.length === 1) { e.preventDefault(); const nextChar = state.targetText[state.typedText.length]; if (nextChar) state.typedText += nextChar; }
            elements.input.value = state.typedText; elements.display.textContent = state.typedText; scrollToBottom();
        });

        document.getElementById('terminal-output').addEventListener('click', () => elements.input.focus());
        window.addEventListener('message', (event) => { if (event.data && event.data.type === 'resetWorkflow') { startScenario(); } });
        startScenario();
    </script>
</body>

</html>
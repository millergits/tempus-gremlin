<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gremlin CLI - Data Products</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&family=Inter:wght@400;600&display=swap');

        body { background-color: #050505; color: #c9d1d9; overflow: hidden; font-family: 'Fira Code', monospace; }
        .terminal-scroll::-webkit-scrollbar { width: 8px; }
        .terminal-scroll::-webkit-scrollbar-track { background: #0d1117; }
        .terminal-scroll::-webkit-scrollbar-thumb { background: #30363d; border-radius: 4px; }
        .terminal-scroll::-webkit-scrollbar-thumb:hover { background: #484f58; }
        .cursor { display: inline-block; width: 10px; height: 1.2em; background-color: #4ade80; animation: blink 1s step-end infinite; vertical-align: text-bottom; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        .term-table { width: 100%; border-collapse: collapse; margin: 1rem 0; font-size: 0.9rem; }
        .term-table th { text-align: left; border-bottom: 1px solid #30363d; color: #8b949e; padding: 0.5rem; }
        .term-table td { padding: 0.5rem; border-bottom: 1px solid #21262d; }
        .diff-add { color: #4ade80; }
        .diff-remove { color: #fdaeb7; }
        .diff-header { color: #8b949e; }
        .scanline { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0) 50%, rgba(0, 0, 0, 0.02) 50%, rgba(0, 0, 0, 0.02)); background-size: 100% 4px; pointer-events: none; z-index: 10; }
        .gremlin-green { color: #4ade80; text-shadow: 0 0 10px rgba(74, 222, 128, 0.3); }
        .ascii-art { font-weight: bold; line-height: 1.1; }
        .code-block { background: #161b22; border: 1px solid #30363d; border-radius: 6px; padding: 1rem; font-family: monospace; font-size: 0.85rem; margin: 0.5rem 0; overflow-x: auto; }
    </style>
</head>

<body class="h-screen w-screen flex flex-col p-4 md:p-8 selection:bg-green-500/30 justify-center items-center">

    <div class="scanline"></div>

    <div class="bg-[#0d1117] border border-[#30363d] rounded-lg shadow-2xl flex flex-col overflow-hidden relative w-full max-w-5xl h-[85vh]">

        <div class="bg-[#010409] px-4 py-2 flex items-center justify-between border-b border-[#30363d]">
            <div class="flex space-x-2">
                <div class="w-3 h-3 rounded-full bg-[#ff5f56]"></div>
                <div class="w-3 h-3 rounded-full bg-[#ffbd2e]"></div>
                <div class="w-3 h-3 rounded-full bg-[#27c93f]"></div>
            </div>
            <div class="text-xs text-[#8b949e] font-semibold flex items-center">
                <i class="fa-solid fa-shield-halved mr-2 text-green-500"></i> scientist@tempus-cluster-01
            </div>
            <div class="w-12"></div>
        </div>

        <div id="terminal-output" class="flex-grow p-6 overflow-y-auto terminal-scroll text-sm md:text-base font-mono">

            <div class="mb-8 animate-fade-in flex items-start space-x-6 border-b border-[#30363d] pb-6">
                <pre class="gremlin-green text-[10px] md:text-[12px] leading-none block">
         ,           ,
        / \         / \
       /   \       /   \
      /     \     /     \
     (       \___/       )
      \   O         O   /
       \       ^       /
        \    _____    /
         \__/     \__/
                </pre>
                <div>
                    <pre class="ascii-art gremlin-green text-[10px] md:text-xs leading-[1.1]">
  ____ ____  _____ __  __ _     ___ _   _
 / ___|  _ \| ____|  \/  | |   |_ _| \ | |
| |  _| |_) |  _| | |\/| | |    | ||  \| |
| |_| |  _ <| |___| |  | | |___ | || |\  |
 \____|_| \_\_____|_|  |_|_____|___|_| \_|</pre>
                    <div class="text-[#8b949e] mt-3 mb-1">Tempus Gremlin CLI <span class="text-green-400">v2.4</span></div>
                    <div class="text-[#c9d1d9] text-[11px] uppercase tracking-wide font-semibold">
                        <span class="gremlin-green">G</span>ENERATIVE <span class="gremlin-green">R</span>ESEARCH <span class="gremlin-green">E</span>NGINE FOR <span class="gremlin-green">M</span>ACHINE <span class="gremlin-green">L</span>EARNING <span class="gremlin-green">I</span>NFRASTRUCTURE & <span class="gremlin-green">N</span>AVIGATION
                    </div>
                </div>
            </div>

            <div id="history"></div>

            <div class="flex items-center mt-4 pb-2" id="input-line">
                <span class="text-green-400 font-bold mr-2">gremlin ></span>
                <div class="relative flex-grow">
                    <input type="text" id="terminal-input" class="w-full bg-transparent border-none outline-none text-[#e6edf3] font-mono caret-transparent" autocomplete="off" spellcheck="false" autofocus>
                    <div id="ghost-text" class="absolute top-0 left-0 pointer-events-none text-[#e6edf3] opacity-50 whitespace-pre-wrap"></div>
                </div>
                <span class="cursor"></span>
            </div>
        </div>
    </div>

    <div class="fixed bottom-8 left-1/2 -translate-x-1/2 z-50 pointer-events-none opacity-70">
        <div class="bg-[#0d1117]/90 text-[#8b949e] text-xs px-4 py-2 rounded-full border border-[#30363d] shadow-2xl backdrop-blur-md flex items-center gap-2">
            <i class="fa-solid fa-terminal text-green-500"></i>
            <span>Pro Tip: Press <span class="text-green-400 font-bold font-mono bg-[#30363d] px-1.5 rounded mx-1">TAB</span> to auto-complete commands</span>
        </div>
    </div>

    <script>
        const endToEndScenario = [
            {
                user: "Find Data Products for Non-Small Cell Lung Cancer with molecular data.",
                ai: {
                    think: "Querying Data Products Library catalog... Filtering: indication='NSCLC', modalities=['clinical', 'molecular']...",
                    response: `
                        <div class="text-green-400 font-bold mb-3">AVAILABLE DATA PRODUCTS</div>

                        <table class="term-table">
                            <thead><tr><th>Type Name</th><th>Version</th><th>Records</th><th>Updated</th><th>Classification</th></tr></thead>
                            <tbody>
                                <tr><td class="text-green-400">clinical_nsclc_outcomes</td><td>v3.2.1</td><td>12,450</td><td>2024-10-15</td><td><span class="text-red-400">SECRET (PHI)</span></td></tr>
                                <tr><td class="text-green-400">molecular_wes_nsclc</td><td>v2.1.0</td><td>8,230</td><td>2024-09-28</td><td><span class="text-red-400">SECRET (PHI)</span></td></tr>
                                <tr><td class="text-green-400">rna_expression_nsclc</td><td>v1.4.2</td><td>6,890</td><td>2024-11-01</td><td><span class="text-red-400">SECRET (PHI)</span></td></tr>
                                <tr><td class="text-green-400">nsclc_treatment_outcomes</td><td>v4.0.0</td><td>11,200</td><td>2024-10-22</td><td><span class="text-red-400">SECRET (PHI)</span></td></tr>
                            </tbody>
                        </table>

                        <div class="text-[#8b949e] text-sm mt-3">
                            Tip: Use <code class="text-purple-400">gremlin > describe clinical_nsclc_outcomes</code> to view the Spec (schema).
                        </div>
                    `
                }
            },
            {
                user: "describe clinical_nsclc_outcomes",
                ai: {
                    think: "Fetching Spec for clinical_nsclc_outcomes v3.2.1...",
                    response: `
                        <div class="text-green-400 font-bold mb-3">SPECIFICATION: clinical_nsclc_outcomes</div>

                        <div class="text-[#c9d1d9] mb-3">
                            <strong>Status:</strong> <span class="text-green-400">PUBLISHED</span><br>
                            <strong>Owner:</strong> data-products-team@tempus.com<br>
                            <strong>Description:</strong> Clinical outcomes for NSCLC patients including OS, PFS, and treatment response.
                        </div>

                        <div class="text-[#8b949e] text-sm mb-2"><strong>Schema (key fields):</strong></div>
                        <table class="term-table">
                            <thead><tr><th>Field</th><th>Type</th><th>Required</th><th>Description</th></tr></thead>
                            <tbody>
                                <tr><td class="text-green-400">patient_id</td><td>STRING</td><td>Yes</td><td>De-identified patient identifier</td></tr>
                                <tr><td class="text-green-400">diagnosis_date</td><td>DATE</td><td>Yes</td><td>Initial NSCLC diagnosis date</td></tr>
                                <tr><td class="text-green-400">stage_at_dx</td><td>STRING</td><td>Yes</td><td>TNM stage at diagnosis</td></tr>
                                <tr><td class="text-yellow-400">os_months</td><td>FLOAT</td><td>No</td><td>Overall survival in months</td></tr>
                                <tr><td class="text-yellow-400">os_event</td><td>BOOLEAN</td><td>No</td><td>Death event indicator</td></tr>
                                <tr><td class="text-yellow-400">1l_tot_days</td><td>INTEGER</td><td>No</td><td>1st Line Time-on-Treatment (days)</td></tr>
                            </tbody>
                        </table>

                        <div class="border-l-2 border-green-500 pl-3 mt-4 text-sm">
                            <span class="text-green-400">Access:</span> You have <strong>QUERY</strong> permission via 'ml-scientists' group.
                        </div>
                    `
                }
            },
            {
                user: "I need to join clinical_nsclc_outcomes with rna_expression_nsclc for patients with 1L data.",
                ai: {
                    think: "Checking permissions... Generating validated join query...",
                    response: `
                        <div class="text-[#c9d1d9] mb-3">Checking permissions...</div>
                        <div class="mb-3">
                            <span class="text-green-400">✅</span> <code>clinical_nsclc_outcomes</code>: QUERY access granted<br>
                            <span class="text-yellow-400">⚠️</span> <code>rna_expression_nsclc</code>: No access. Initiating request...
                        </div>

                        <div class="border-l-2 border-yellow-500 pl-3 mb-4 text-sm">
                            <div class="text-yellow-400 mb-1">Access Request Submitted</div>
                            <div class="text-[#c9d1d9]">
                                To: data-products-team@tempus.com<br>
                                Request ID: <code class="text-purple-400">DPS-REQ-2024-1847</code><br>
                                Expected turnaround: 24-48 hours
                            </div>
                        </div>

                        <div class="text-[#c9d1d9] mb-2"><strong>Meanwhile, here's the join query you'll use once approved:</strong></div>

                        <div class="code-block">
                            <pre class="text-xs"><span class="text-purple-400">SELECT</span>
  c.patient_id,
  c.os_months,
  c.os_event,
  c.1l_tot_days,
  r.gene_expression_vector
<span class="text-purple-400">FROM</span> \`tempus-prod.dpl.clinical_nsclc_outcomes\` c
<span class="text-purple-400">JOIN</span> \`tempus-prod.dpl.rna_expression_nsclc\` r
  <span class="text-purple-400">ON</span> c.patient_id = r.patient_id
<span class="text-purple-400">WHERE</span> c.line_of_therapy = 1
  <span class="text-purple-400">AND</span> c.1l_tot_days IS NOT NULL</pre>
                        </div>

                        <div class="text-[#8b949e] text-sm mt-3">Bookmark this query. I'll notify you when access is granted.</div>
                    `
                }
            },
            {
                user: "Pin this cohort as 'nsclc_fusion_train_v1' for my experiment.",
                ai: {
                    think: "Executing cohort query... Materializing in Atlas... Creating Data Product...",
                    response: `
                        <div class="text-[#c9d1d9] mb-3">Executing cohort query... <span class="text-green-400">DONE</span></div>
                        <div class="text-[#c9d1d9] mb-4">Result: <span class="text-green-400 font-bold">4,892 patients</span> with complete 1L TOT + RNA data.</div>

                        <div class="text-[#c9d1d9] mb-2">Creating Data Product...</div>
                        <div class="text-[#8b949e] text-sm mb-3 ml-4">
                            Type: <code>ml_training_cohort</code> (internal)<br>
                            Version: <code>v1.0.0</code><br>
                            Spec: Derived from clinical_nsclc_outcomes (v3.2.1) + rna_expression_nsclc (v1.4.2)
                        </div>

                        <div class="text-[#c9d1d9] mb-2">Registering in Atlas...</div>
                        <div class="code-block text-xs">
                            Dataset URI: <span class="text-purple-400">atlas://datasets/nsclc_fusion_train_v1</span>

                            Lineage:
                            └─ clinical_nsclc_outcomes@v3.2.1 (12,450 → 4,892 pts)
                            └─ rna_expression_nsclc@v1.4.2 (6,890 → 4,892 pts)
                        </div>

                        <div class="mt-4">
                            <span class="text-green-400 font-bold">✅ Dataset pinned:</span> <code class="text-purple-400">atlas://datasets/nsclc_fusion_train_v1</code><br>
                            <span class="text-[#8b949e] text-sm">
                                SHA256: <code>a7f3e9c2...</code><br>
                                Immutable: Yes<br>
                                Expires: Never (manual deletion only)
                            </span>
                        </div>

                        <div class="text-[#c9d1d9] mt-4">This dataset is now safe to reference in your experiment config.</div>
                    `
                }
            },
            {
                user: "What data was model 'nsclc_fusion_prod_v2' trained on?",
                ai: {
                    think: "Querying Atlas lineage graph... Tracing provenance...",
                    response: `
                        <div class="text-green-400 font-bold mb-3">LINEAGE TRACE: nsclc_fusion_prod_v2</div>

                        <div class="code-block text-xs">
Model: <span class="text-purple-400">atlas://models/nsclc_fusion_prod_v2</span>
├─ Training Run: <span class="text-purple-400">atlas://runs/exp-fusion-2024-08-15</span>
│  ├─ Config: exp_fusion_nsclc_v2.yaml (SHA: b3c8d1...)
│  └─ Dataset: <span class="text-purple-400">atlas://datasets/nsclc_fusion_train_v1</span>
│     ├─ Created: 2024-08-10 by jsmith@tempus.com
│     ├─ Query Hash: 9f2a4b...
│     └─ Source Data Products:
│        ├─ clinical_nsclc_outcomes@v3.2.1 (DPL)
│        │  └─ Spec Status: <span class="text-green-400">PUBLISHED (still current)</span>
│        └─ rna_expression_nsclc@v1.4.2 (DPL)
│           └─ Spec Status: <span class="text-yellow-400">DEPRECATED (v1.5.0 available)</span>
│              <span class="text-yellow-400">⚠️ Note: v1.5.0 fixed gene normalization bug (JIRA: DATA-4521)</span>
                        </div>

                        <div class="border-l-2 border-yellow-500 pl-3 mt-4">
                            <div class="text-yellow-400 font-bold text-sm mb-1">POTENTIAL ISSUE DETECTED</div>
                            <div class="text-[#c9d1d9] text-sm">
                                The RNA data used was v1.4.2, which has since been deprecated.<br>
                                Consider retraining on v1.5.0 if gene expression is driving predictions.
                            </div>
                        </div>

                        <div class="text-[#c9d1d9] mt-4">Compare model performance on v1.4.2 vs v1.5.0 cohorts? <span class="text-green-400">[Y/n]</span></div>
                    `
                }
            },
            {
                user: "Y",
                ai: {
                    think: "Creating comparison cohort with v1.5.0... Running differential analysis...",
                    response: `
                        <div class="text-green-400 mb-2">✔ Comparison analysis complete.</div>

                        <table class="term-table">
                            <thead><tr><th>Metric</th><th>v1.4.2</th><th>v1.5.0</th><th>Delta</th></tr></thead>
                            <tbody>
                                <tr><td>Patients</td><td>4,892</td><td>4,847</td><td><span class="text-yellow-400">-45 (0.9%)</span></td></tr>
                                <tr><td>Gene Coverage</td><td>18,421</td><td>19,102</td><td><span class="text-green-400">+681 genes</span></td></tr>
                                <tr><td>Expression Dist.</td><td>Skewed</td><td>Normal</td><td><span class="text-green-400">✅ Fixed</span></td></tr>
                            </tbody>
                        </table>

                        <div class="border-l-2 border-green-500 pl-3 mt-4">
                            <div class="text-green-400 font-bold text-sm mb-1">Recommendation</div>
                            <div class="text-[#c9d1d9] text-sm">
                                The normalization fix in v1.5.0 corrects systematic bias.<br>
                                Retraining is <strong>recommended</strong> for production deployment.
                            </div>
                        </div>

                        <div class="text-[#c9d1d9] mt-4">Create a new training cohort with v1.5.0? <span class="text-green-400">[Y/n]</span></div>
                    `
                }
            }
        ];

        const state = { step: 0, isTyping: false, isThinking: false, typedText: "" };
        const elements = { history: document.getElementById('history'), input: document.getElementById('terminal-input'), ghost: document.getElementById('ghost-text'), output: document.getElementById('terminal-output') };

        function startScenario() {
            state.step = 0;
            elements.history.innerHTML = '';
            const div = document.createElement('div');
            div.className = "my-4 border-t border-dashed border-slate-700 pt-2 text-center text-xs text-slate-600";
            div.innerText = `--- NEW SESSION: DATA PRODUCTS INTEGRATION ---`;
            elements.history.appendChild(div);
            prepareStep();
        }

        function prepareStep() {
            if (state.step >= endToEndScenario.length) {
                state.targetText = ""; elements.input.value = ""; elements.ghost.textContent = "";
                const endDiv = document.createElement('div');
                endDiv.className = "mt-8 text-center text-[#8b949e] text-xs animate-pulse";
                endDiv.innerText = "[ END OF DATA PRODUCTS DEMO ]";
                elements.history.appendChild(endDiv);
                scrollToBottom();
                window.parent.postMessage({ type: 'workflowComplete' }, '*');
                return;
            }
            state.targetText = endToEndScenario[state.step].user;
            state.typedText = ""; elements.input.value = ""; elements.ghost.textContent = "";
            elements.input.focus(); scrollToBottom();
        }

        function scrollToBottom() { elements.output.scrollTop = elements.output.scrollHeight; requestAnimationFrame(() => { elements.output.scrollTop = elements.output.scrollHeight; }); }

        function addEntry(type, content) {
            const div = document.createElement('div');
            div.className = "mb-6 animate-fade-in";
            if (type === 'user') { div.innerHTML = `<div class="flex items-start"><span class="text-green-400 font-bold mr-2 mt-0.5">❯</span><div class="text-[#e6edf3] font-semibold">${content}</div></div>`; }
            else if (type === 'ai') { div.innerHTML = `<div class="flex items-start mt-2"><div class="text-purple-400 font-bold mr-3 mt-0.5 text-xs">GREMLIN</div><div class="flex-grow text-[#c9d1d9] leading-relaxed text-sm">${content}</div></div>`; }
            else if (type === 'think') { div.id = "thinking"; div.innerHTML = `<div class="flex items-center text-slate-500 text-xs ml-9 animate-pulse font-mono"><i class="fa-solid fa-microchip mr-2"></i> ${content}</div>`; }
            elements.history.appendChild(div); scrollToBottom(); return div;
        }

        function submit() {
            if (state.step >= endToEndScenario.length) return;
            const text = elements.input.value; if (!text.trim()) return;
            addEntry('user', text); elements.input.value = ""; elements.ghost.textContent = ""; state.typedText = "";
            state.isThinking = true;
            const scenario = endToEndScenario[state.step];
            const thinkEl = addEntry('think', scenario.ai.think);
            setTimeout(() => {
                thinkEl.innerHTML = `<div class="flex items-center text-slate-600 text-xs ml-9 font-mono"><span class="text-green-500 mr-2">[LOG]</span> ${scenario.ai.think.replace('...', '')} ... <span class="text-green-500 ml-1">DONE</span></div>`;
                thinkEl.id = ""; thinkEl.classList.remove("animate-pulse");
                addEntry('ai', scenario.ai.response);
                state.isThinking = false; state.step++;
                window.parent.postMessage({ type: 'cliStepComplete', step: state.step }, '*');
                prepareStep();
            }, 1200);
        }

        elements.input.addEventListener('keydown', (e) => {
            if (state.isThinking || state.step >= endToEndScenario.length) { e.preventDefault(); return; }
            if (e.key === 'Tab') { e.preventDefault(); if (state.typedText.length < state.targetText.length) { state.typedText = state.targetText; elements.input.value = state.typedText; elements.ghost.textContent = state.typedText; scrollToBottom(); } return; }
            if (e.key === 'Enter') { state.typedText = state.targetText; elements.input.value = state.typedText; elements.ghost.textContent = state.typedText; submit(); e.preventDefault(); }
            else if (e.key === 'Backspace') { state.typedText = state.typedText.slice(0, -1); e.preventDefault(); }
            else if (!e.ctrlKey && !e.metaKey && !e.altKey && e.key.length === 1) { e.preventDefault(); const nextChar = state.targetText[state.typedText.length]; if (nextChar) state.typedText += nextChar; }
            elements.input.value = state.typedText; elements.ghost.textContent = state.typedText; scrollToBottom();
        });

        document.getElementById('terminal-output').addEventListener('click', () => elements.input.focus());
        window.addEventListener('message', (event) => { if (event.data && event.data.type === 'resetWorkflow') { startScenario(); } });
        startScenario();
    </script>
</body>

</html>
